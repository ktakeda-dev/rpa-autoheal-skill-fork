# ワークフローテンプレート
# 探索モードで自動生成されるが、手動で作成・編集も可能
#
# 【重要】セレクタは純粋なCSSセレクタを使用すること
# アクション定義: rpa-docs/actions.md を参照
# スキーマ: schemas/workflow.schema.json

name: workflow-name           # 必須: kebab-case形式
description: ワークフローの説明

# 入力パラメータ（オプション）
# type: string | number | boolean | image
input:
  image_file:
    type: image
    description: "入力画像"
    required: false
  keyword:
    type: string
    description: "検索キーワード"
    required: true
    example: "laptop"
  count:
    type: number
    description: "件数"
    default: 10

# 定数値（オプション）
constants:
  base_url: "https://example.com"
  timeout: 5000

# 自動化ステップ
steps:
  # ページ遷移
  - name: ページを開く
    action: navigate
    url: https://example.com

  # 要素の待機
  - name: ページ読み込み待機
    action: wait
    selector: "#main-content"
    timeout: 5000

  # ログイン待機（手動ログインが必要な場合）
  - name: ログイン完了を待機
    action: wait
    selector: "#user-menu"          # ログイン後に表示される要素
    timeout: 120000                 # 2分（手動ログイン用）
    hint: "ログインしてください。完了後、自動的に続行します"

  # クリック
  - name: ボタンをクリック
    action: click
    selector: "#submit-btn"
    hint: "送信ボタン（青色、画面右下）"  # フォールバック時のAI向けヒント

  # テキスト入力（fill）
  - name: テキストを入力
    action: fill
    selector: "input[name='search']"
    value: "${input.keyword}"
    hint: "検索入力欄"

  # キーボード入力（type）- セレクタ不要、フォーカス位置に入力
  - name: キーボードで入力
    action: type
    value: "${input.keyword}"
    hint: "ドロップダウン内検索ボックス"

  # キー押下
  - name: Enterキーを押す
    action: press
    selector: "input[name='search']"
    key: "Enter"

  # ドロップダウン選択
  - name: オプションを選択
    action: select
    selector: "select[name='category']"
    value: "electronics"

  # ファイルアップロード
  - name: ファイルをアップロード
    action: file_upload
    selector: "input[type='file']"
    file: "${input.image_file}"

  # Playwrightコード直接実行（複雑な操作用）
  - name: 複雑な操作をコードで実行
    action: playwright_code
    code: |
      // Playwright APIを使用した複雑な操作
      // page, extract, input, constants が利用可能
      const rows = page.getByRole('row');
      for (let i = 0; i < await rows.count(); i++) {
        const row = rows.nth(i);
        await row.getByLabel('Field').fill('value');
      }
    output: result_variable
    hint: "テーブルの各行にあるFieldラベルの入力欄"

  # 条件付き実行（when）
  # when が指定されたステップは、条件が true の場合のみ実行される
  # 条件式の書き方:
  #   - 単一条件: { field, op, value }
  #   - 複数条件: { conditions: [...], match: all/any }
  #   - 演算子: ==, !=, >, <, >=, <=
  #   - 参照可能: extract.*, input.*, constants.*
  - name: 高額時のみ実行するステップ
    action: fill
    selector: "input[name='extra_field']"
    value: "追加情報"
    when:
      field: extract.amount
      op: ">"
      value: 10000

  # 複数条件（すべて満たす場合）
  - name: 複数条件のステップ
    action: click
    selector: "#special-button"
    when:
      conditions:
        - field: extract.amount
          op: ">"
          value: 10000
        - field: input.count
          op: ">"
          value: 0
      match: all              # all（すべて満たす）| any（いずれか満たす）

# 出力定義（オプション）
output:
  result:
    description: "実行結果"
