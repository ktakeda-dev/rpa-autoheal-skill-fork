# 改善レポート

<!--
## 目的
フォールバックなしでJSテンプレートだけで全ステップが高速実行できるように改善する。

フォールバック発生時の原因は以下のいずれか:
- YAML: セレクタや条件分岐の問題
- SKILL: プロンプトの指示不足・テンプレート不足
- 実装: yaml-to-js変換ロジックの不備・新アクション未対応
- 外部要因: サイト側の変更・ネットワーク・一時的問題

原因を特定し、適切な対応先を提示する。
-->

## 実行サマリー
- ワークフロー: {{workflow_name}}
- 処理件数: {{success_count}}件成功 / {{failure_count}}件失敗
- 実行日時: {{execution_date}}

## 対応状況: 未対応

<!-- 対応状況は以下のいずれか:
- 未対応: まだ修正を反映していない
- 解決済み: 修正完了
- 対応不要: 一時的な問題、または仕様上MCP必須
- 要調査: 原因が特定できず、追加調査が必要
-->

## フォールバック発生箇所

実行中にMCPフォールバックが発生したステップ:

| ステップ | セレクタ | 原因 | 原因カテゴリ | 改善案 |
|----------|----------|------|--------------|--------|
| {{step_name}} | `{{selector}}` | {{reason}} | {{category}} | {{improvement}} |

<!--
原因カテゴリは以下のいずれか:
- YAML: セレクタ・条件分岐・待機時間など、YAMLの修正で解決
- SKILL: プロンプト・テンプレートなど、SKILLの修正で解決
- 実装: yaml-to-js.js の修正で解決
- 外部要因: サイト側の問題・ネットワーク・一時的な問題

フォールバックの原因:
- タイムアウト: セレクタが見つからなかった
- ダイアログ発生: ファイル選択などMCP必須の操作
- 要素不可視: 要素は存在するがクリック不可
- 変換エラー: JS変換時に問題が発生

フォールバックなしの場合は「なし」と記載
-->

## 原因分析

<!--
原因カテゴリの判定フローチャート:

1. 変換エラーまたは未対応アクションか？ → 実装
2. YAMLのセレクタ・条件・待機で改善可能か？ → YAML
3. テンプレート生成プロンプトの指示不足か？ → SKILL
4. サイト変更・一時的問題か？ → 外部要因
-->

### 推定原因カテゴリ: {{category}}

**判定理由:**
- {{reason_detail}}

---

## 改善提案

<!--
原因カテゴリに応じて、適切なセクションに記載:
- YAML修正: セレクタ・条件分岐・待機時間の変更
- SKILL修正: プロンプト・テンプレートの改善
- 実装修正: yaml-to-js.js のバグ修正・新アクション対応

複数カテゴリにまたがる場合は、それぞれのセクションに記載
-->

### YAML修正案

問題が発生した場合、以下の観点で改善案を提示:

- **条件分岐の追加（when）**: どのような条件で分岐が必要か
- **新しいステップの追加**: 追加が必要なステップ
- **固定値の見直し**: 動的に変更すべき値
- **待機時間の調整**: wait の値を変更
- **セレクタの改善**: より堅牢なセレクタに変更

```yaml
# 現在
- name: ステップ名
  action: fill
  value: "固定値"

# 提案: when で条件分岐
- name: ステップ名（条件A）
  action: fill
  value: "値A"
  when:
    field: extract.field
    op: "<="
    value: 10000

- name: ステップ名（条件B）
  action: fill
  value: "値B"
  when:
    field: extract.field
    op: ">"
    value: 10000
```

<!-- 改善不要の場合は「YAML修正不要」と記載 -->

### SKILL修正案

<!--
SKILLの修正が必要な場合の典型例:
- テンプレート生成時のプロンプトに待機戦略の指示が不足
- エラーハンドリングの方針が不明確
- 新しいUI パターンへの対応指示が不足
- hint の書き方の指針が不足

記載例:
- SKILL.md の「## フォールバック手順」に待機戦略を追加
- improvement-report.md テンプレートに新しいセクションを追加
-->

**修正対象ファイル:** `.claude/skills/rpa-execute/SKILL.md`

**修正内容:**
- {{skill_improvement}}

<!-- 改善不要の場合は「SKILL修正不要」と記載 -->

### 実装修正案

<!--
実装の修正が必要な場合の典型例:
- 新しいアクションタイプが yaml-to-js.js で未対応
- 変換ロジックのバグ（エスケープ漏れ、構文エラー等）
- スキーマ定義の不備

記載例:
- scripts/yaml-to-js.js に新アクション "hover" の対応を追加
- schemas/workflow.schema.json に新フィールドを追加
-->

**修正対象ファイル:** `scripts/yaml-to-js.js`

**修正内容:**
- {{implementation_improvement}}

<!-- 改善不要の場合は「実装修正不要」と記載 -->

---

## 次回実行時の注意点

- {{注意点1}}
- {{注意点2}}

<!-- 注意点がない場合は「特になし」と記載 -->

## 修正の依頼方法

改善レポートの内容を基に修正する場合は、対象に応じて適切なアプローチを選択:

| 原因カテゴリ | 対応方法 |
|--------------|----------|
| YAML | **探索モード（`/rpa-explore`）** を使用 |
| SKILL | SKILL.md を直接編集 |
| 実装 | scripts/yaml-to-js.js を直接編集 |

```
「改善レポートを基にYAMLを修正して」
「このワークフローの〇〇を△△に変えて」
「SKILLに待機戦略の指示を追加して」
「yaml-to-js に hover アクションを追加して」
```

---

## 原因カテゴリのトリアージ基準

<!--
### YAML修正が適切なケース
- セレクタが動的に変わるサイトで固定セレクタを使用
- 条件分岐（when）の追加が必要
- 待機時間が不足している
- より具体的なセレクタが必要

### SKILL修正が適切なケース
- テンプレート生成時のプロンプトに待機戦略の指示が不足
- エラーハンドリングの方針が不明確
- 新しいUIパターンへの対応ガイダンスが不足
- hint の記載指針が不足

### 実装修正が適切なケース
- 新しいアクションタイプが yaml-to-js.js で未対応
- 変換ロジックのバグ
- スキーマ定義の不備
- JS生成コードの構文エラー

### 外部要因（対応不要）のケース
- サイト側の一時的なメンテナンス
- ネットワーク障害
- 認証切れ（再ログインで解決）
- サイトの仕様変更（大規模な再設計が必要）
-->
